<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head('Yeni Satış Başlat')">
    <title>Yeni Satış Başlat</title>
</head>
<body>
    <nav th:replace="fragments/layout :: navbar('sales')"></nav>
    
    <div class="container py-4">
        <div class="mb-4">
            <h1>Yeni Satış Başlat</h1>
            <p class="text-muted">Müşteri ve araç seçerek yeni bir satış başlatın.</p>
        </div>
        
        <!-- Alert Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}">Success message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}">Error message</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        
        <div class="card">
            <div class="card-header bg-light">
                <h5 class="mb-0">Satış Bilgileri</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/sales/initiate}" method="post">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="customerId" class="form-label">Müşteri</label>
                            <select id="customerId" name="customerId" class="form-select" required>
                                <option value="">Müşteri Seçin</option>
                                <option th:each="customer : ${customers}" 
                                        th:value="${customer.id}" 
                                        th:text="${customer.firstName + ' ' + customer.lastName + ' (' + customer.email + ')'}">
                                    John Doe (john@example.com)
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="vehicleId" class="form-label">Araç</label>
                            <select id="vehicleId" name="vehicleId" class="form-select" required>
                                <option value="">Araç Seçin</option>
                                <option th:each="vehicle : ${vehicles}" 
                                        th:value="${vehicle.id}" 
                                        th:text="${vehicle.brand + ' ' + vehicle.model + ' (' + vehicle.year + ') - ' + vehicle.color + ' - ₺' + #numbers.formatDecimal(vehicle.price, 0, 'COMMA', 0, 'POINT')}">
                                    Toyota Corolla (2022) - White - ₺500,000
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="salePrice" class="form-label">Satış Fiyatı (₺)</label>
                            <input type="number" id="salePrice" name="salePrice" class="form-control" step="0.01" min="0" required>
                        </div>
                        <div class="col-md-6">
                            <label for="discount" class="form-label">İndirim Tutarı (₺) (Opsiyonel)</label>
                            <input type="number" id="discount" name="discount" class="form-control" step="0.01" min="0">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="paymentMethod" class="form-label">Ödeme Yöntemi</label>
                        <select id="paymentMethod" name="paymentMethod" class="form-select" required>
                            <option value="">Ödeme Yöntemi Seçin</option>
                            <option th:each="method : ${paymentMethods}" 
                                    th:value="${method}" 
                                    th:text="${method}">
                                CASH
                            </option>
                        </select>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a th:href="@{/sales}" class="btn btn-secondary">İptal</a>
                        <button type="submit" class="btn btn-primary">Satış Başlat</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <footer th:replace="fragments/layout :: footer"></footer>
    
    <script>
        // Set the sale price automatically when a vehicle is selected
        document.getElementById('vehicleId').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const priceText = selectedOption.text.split('₺')[1];
            if (priceText) {
                const price = priceText.replace(/,/g, '');
                document.getElementById('salePrice').value = price;
            }
        });
    </script>
</body>
</html> 